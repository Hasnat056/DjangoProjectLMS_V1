<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Report - {{ department.departmentname }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="icon" type="image/png" href="https://namal.edu.pk/uploads/logo4980416.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }

        .sidebar-gradient {
            background: linear-gradient(180deg, #1e293b 0%, #334155 50%, #475569 100%);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .nav-item {
            transition: all 0.2s ease;
            margin: 2px 8px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(2px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, #0f766e, #059669);
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.3);
        }

        .card-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #0f766e, #059669);
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(15, 118, 110, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0d5f5a, #047857);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(15, 118, 110, 0.3);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .print-hidden {
            display: block;
        }

        @media print {
            .print-hidden {
                display: none !important;
            }
            .print-break {
                page-break-before: always;
            }
        }

        .pulse-ring {
            animation: pulse-ring 2s infinite;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.33);
            }
            40%, 50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: scale(1.2);
            }
        }

        .export-dropdown {
            transform: translateY(-10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .export-dropdown.show {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-72 sidebar-gradient text-white flex-shrink-0 flex flex-col print-hidden">
            <!-- Header -->
            <div class="p-6 border-b border-white/10">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 rounded-xl bg-white p-2 shadow-lg">
                        <img src="https://namal.edu.pk/uploads/logo4980416.png"
                             alt="Namal University Logo"
                             class="w-full h-full object-contain rounded-lg">
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Namal LMS</h1>
                        <p class="text-xs text-white/70">Department Analytics</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                <div class="nav-item p-3 cursor-pointer" onclick="window.location.href='/admin/dashboard/'">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                        </svg>
                        <span class="font-medium">Dashboard</span>
                    </div>
                </div>
                <div class="nav-item p-3 cursor-pointer active">
                    <div class="flex items-center space-x-3">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z"></path>
                        </svg>
                        <span class="font-medium">Department Reports</span>
                    </div>
                </div>
            </nav>

            <!-- User Profile -->
            <div class="p-4 border-t border-white/10">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-emerald-600 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm font-bold" id="admin-initials">A</span>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium" id="admin-name">Administrator</p>
                        <p class="text-xs text-white/70" id="admin-role">System Admin</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 overflow-hidden flex flex-col">
            <!-- Header -->
            <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4 print-hidden">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="flex items-center space-x-2 text-sm text-gray-500">
                            <span>Admin Panel</span>
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            <a href="/admin/dashboard/?section=reports" class="hover:text-emerald-600">Reports</a>
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-emerald-600 font-medium">Department Analytics</span>
                        </div>
                        <h2 class="text-2xl font-bold text-gray-900 mt-1" id="department-name">
                            Computer Science Department
                        </h2>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Export Dropdown -->
                        <div class="relative">
                            <button onclick="toggleExportDropdown()" class="btn-primary text-white px-4 py-2 rounded-lg flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                                <span>Export Report</span>
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                            <div id="export-dropdown" class="export-dropdown absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg z-50 border border-gray-200">
                                <div class="py-1">
                                    <button onclick="exportToPDF()" class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <svg class="w-4 h-4 mr-3 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
                                        </svg>
                                        Export as PDF
                                    </button>
                                    <button onclick="exportToExcel()" class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <svg class="w-4 h-4 mr-3 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd"></path>
                                        </svg>
                                        Export as Excel
                                    </button>
                                    <button onclick="printReport()" class="flex items-center w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                        <svg class="w-4 h-4 mr-3 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd"></path>
                                        </svg>
                                        Print Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <a href="/admin/dashboard/?section=reports" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span>Back to Reports</span>
                        </a>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="flex-1 overflow-y-auto bg-gray-50 p-6" id="report-content">
                <div class="max-w-7xl mx-auto space-y-6">

                    <!-- Report Header -->
                    <div class="text-center mb-8 print-only" style="display: none;">
                        <img src="https://namal.edu.pk/uploads/logo4980416.png" alt="Namal University" class="h-16 mx-auto mb-4">
                        <h1 class="text-3xl font-bold text-gray-900">Department Analytics Report</h1>
                        <p class="text-gray-600 mt-2" id="print-department-name">Computer Science Department</p>
                        <p class="text-sm text-gray-500 mt-1" id="print-date">Generated on: December 15, 2024</p>
                    </div>

                    <!-- Overview Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card relative overflow-hidden bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl p-6 text-white shadow-xl">
                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-20 h-20 bg-white/10 rounded-full"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-white/20 rounded-lg backdrop-blur-sm">
                                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z"></path>
                                        </svg>
                                    </div>
                                    <span class="text-blue-200 text-sm font-medium">Active</span>
                                </div>
                                <div class="text-3xl font-bold mb-2" id="total-programs">8</div>
                                <div class="text-blue-200 text-sm">Programs Offered</div>
                            </div>
                        </div>

                        <div class="stat-card relative overflow-hidden bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-2xl p-6 text-white shadow-xl">
                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-20 h-20 bg-white/10 rounded-full"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-white/20 rounded-lg backdrop-blur-sm">
                                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
                                        </svg>
                                    </div>
                                    <span class="text-emerald-200 text-sm font-medium">Teaching</span>
                                </div>
                                <div class="text-3xl font-bold mb-2" id="total-faculty">42</div>
                                <div class="text-emerald-200 text-sm">Faculty Members</div>
                            </div>
                        </div>

                        <div class="stat-card relative overflow-hidden bg-gradient-to-br from-purple-500 to-purple-700 rounded-2xl p-6 text-white shadow-xl">
                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-20 h-20 bg-white/10 rounded-full"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-white/20 rounded-lg backdrop-blur-sm">
                                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path>
                                        </svg>
                                    </div>
                                    <span class="text-purple-200 text-sm font-medium">Enrolled</span>
                                </div>
                                <div class="text-3xl font-bold mb-2" id="total-students">1,245</div>
                                <div class="text-purple-200 text-sm">Total Students</div>
                            </div>
                        </div>

                        <div class="stat-card relative overflow-hidden bg-gradient-to-br from-orange-500 to-orange-700 rounded-2xl p-6 text-white shadow-xl">
                            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-20 h-20 bg-white/10 rounded-full"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="p-3 bg-white/20 rounded-lg backdrop-blur-sm">
                                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 4.804A7.968 7.968 0 005.5 4c-1.255 0-2.443.29-3.5.804v10A7.969 7.969 0 015.5 14c1.669 0 3.218.51 4.5 1.385A7.962 7.962 0 0114.5 14c1.255 0 2.443.29 3.5.804v-10A7.968 7.968 0 0014.5 4c-1.255 0-2.443.29-3.5.804V12a1 1 0 11-2 0V4.804z"></path>
                                        </svg>
                                    </div>
                                    <span class="text-orange-200 text-sm font-medium">Active</span>
                                </div>
                                <div class="text-3xl font-bold mb-2" id="total-allocations">156</div>
                                <div class="text-orange-200 text-sm">Course Allocations</div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Program Performance Chart -->
                        <div class="card-gradient rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                <svg class="w-5 h-5 text-emerald-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"></path>
                                    <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"></path>
                                </svg>
                                Program Performance Overview
                            </h3>
                            <div class="chart-container">
                                <canvas id="programChart"></canvas>
                            </div>
                        </div>

                        <!-- Faculty Workload Chart -->
                        <div class="card-gradient rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                <svg class="w-5 h-5 text-emerald-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                                </svg>
                                Faculty Workload Distribution
                            </h3>
                            <div class="chart-container">
                                <canvas id="workloadChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Program Performance Table -->
                    <div class="card-gradient rounded-xl p-6 mb-8 print-break">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-emerald-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"></path>
                            </svg>
                            Program Performance Analysis
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full" id="program-performance-table">
                                <thead>
                                    <tr class="border-b-2 border-gray-200">
                                        <th class="text-left py-4 px-6 text-sm font-bold text-gray-700 uppercase tracking-wider">Program</th>
                                        <th class="text-center py-4 px-4 text-sm font-bold text-blue-700 uppercase tracking-wider">Students</th>
                                        <th class="text-center py-4 px-4 text-sm font-bold text-green-700 uppercase tracking-wider">Avg GPA</th>
                                        <th class="text-center py-4 px-4 text-sm font-bold text-purple-700 uppercase tracking-wider">Performance</th>
                                        <th class="text-center py-4 px-4 text-sm font-bold text-orange-700 uppercase tracking-wider">Status</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100" id="program-table-body">
                                    <!-- Dynamic content will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Faculty Workload Table -->
                    <div class="card-gradient rounded-xl p-6 mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-emerald-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"></path>
                            </svg>
                            Faculty Workload Overview
                        </h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full" id="faculty-workload-table">
                                <thead>
                                    <tr class="border-b-2 border-gray-200">
                                        <th class="text-left py-4 px-6 text-sm font-bold text-gray-700 uppercase tracking-wider">Faculty</th>
                                        <th class="text-center py-4 px-4 text-sm font-bold text-emerald-700 uppercase tracking-wider">Courses</th>
                                        <th class="text-center py-4 px-4 text-sm font-bold text-blue-700 uppercase tracking-wider">Workload</th>
                                        <th class="text-left py-4 px-4 text-sm font-bold text-purple-700 uppercase tracking-wider">Assigned Courses</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-100" id="faculty-table-body">
                                    <!-- Dynamic content will be inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Department Summary -->
                    <div class="card-gradient rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-emerald-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.5 4a.5.5 0 01.5.5v4a.5.5 0 01-.5.5h-9a.5.5 0 01-.5-.5v-4a.5.5 0 01.5-.5h9z" clip-rule="evenodd"></path>
                            </svg>
                            Department Executive Summary
                        </h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg">
                                    <h4 class="font-semibold text-gray-900 mb-2">Key Metrics</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">Student-Faculty Ratio</span>
                                            <span class="font-medium text-gray-900" id="student-faculty-ratio">29.6:1</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">Average Program GPA</span>
                                            <span class="font-medium text-gray-900" id="avg-program-gpa">3.42</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">Course Completion Rate</span>
                                            <span class="font-medium text-gray-900" id="completion-rate">87.3%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg">
                                    <h4 class="font-semibold text-gray-900 mb-2">Performance Indicators</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">High Performing Programs</span>
                                            <span class="font-medium text-green-600" id="high-performing">5/8</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">Faculty Utilization</span>
                                            <span class="font-medium text-green-600" id="faculty-utilization">92.1%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="p-4 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-lg">
                                    <h4 class="font-semibold text-gray-900 mb-2">Recommendations</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li>• Consider expanding high-performing programs</li>
                                        <li>• Review faculty allocation for underperforming courses</li>
                                        <li>• Implement student support programs for low GPA courses</li>
                                        <li>• Optimize resource allocation based on enrollment trends</li>
                                    </ul>
                                </div>
                                <div class="p-4 bg-gradient-to-r from-purple-50 to-violet-50 rounded-lg">
                                    <h4 class="font-semibold text-gray-900 mb-2">Action Items</h4>
                                    <div class="space-y-2">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-2 h-2 bg-red-400 rounded-full"></div>
                                            <span class="text-sm text-gray-600">Review underperforming programs</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
                                            <span class="text-sm text-gray-600">Faculty development programs</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                            <span class="text-sm text-gray-600">Curriculum optimization</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Sample data - Replace with actual Django template variables
         const departmentData = {
            name: "{{ department.departmentname }}",
            programs: [
                {% for program_perf in program_performance %}
                {
                    name: "{{ program_perf.program.programname }}",
                    students: {{ program_perf.student_count }},
                    avgGpa: {% if program_perf.avg_gpa != 'N/A' %}{{ program_perf.avg_gpa }}{% else %}0{% endif %},
                    performance: "{% if program_perf.avg_gpa != 'N/A' %}{% if program_perf.avg_gpa >= 3.5 %}Outstanding{% elif program_perf.avg_gpa >= 3.0 %}Excellent{% elif program_perf.avg_gpa >= 2.5 %}Good{% else %}Needs Improvement{% endif %}{% else %}No Data{% endif %}"
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
            faculty: [
                {% for faculty_work in faculty_workload %}
                {
                    name: "{{ faculty_work.faculty.employeeid.fname }} {{ faculty_work.faculty.employeeid.lname }}",
                    courses: {{ faculty_work.allocation_count }},
                    workload: "{% if faculty_work.allocation_count >= 4 %}High{% elif faculty_work.allocation_count >= 2 %}Medium{% else %}Low{% endif %}",
                    assignedCourses: [{% for course in faculty_work.courses %}"{{ course.coursecode }}"{% if not forloop.last %}, {% endif %}{% endfor %}]
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
            stats: {
                totalPrograms: {{ stats.total_programs }},
                totalFaculty: {{ stats.total_faculty }},
                totalStudents: {{ stats.total_students }},
                totalAllocations: {{ stats.total_allocations }}
            }
        };

        // Initialize the report
        document.addEventListener('DOMContentLoaded', function() {
            loadDepartmentData();
            initializeCharts();
            updatePrintInfo();
            loadAdminProfile();
        });

        function loadDepartmentData() {
            // Update department name
            document.getElementById('department-name').textContent = departmentData.name;
            document.getElementById('print-department-name').textContent = departmentData.name;

            // Update statistics
            document.getElementById('total-programs').textContent = departmentData.programs.length;
            document.getElementById('total-faculty').textContent = departmentData.faculty.length;
            document.getElementById('total-students').textContent = departmentData.programs.reduce((sum, p) => sum + p.students, 0).toLocaleString();
            document.getElementById('total-allocations').textContent = departmentData.faculty.reduce((sum, f) => sum + f.courses, 0);

            // Calculate metrics
            const totalStudents = departmentData.programs.reduce((sum, p) => sum + p.students, 0);
            const totalFaculty = departmentData.faculty.length;
            const avgGpa = (departmentData.programs.reduce((sum, p) => sum + (p.avgGpa * p.students), 0) / totalStudents).toFixed(2);

            document.getElementById('student-faculty-ratio').textContent = `${(totalStudents / totalFaculty).toFixed(1)}:1`;
            document.getElementById('avg-program-gpa').textContent = avgGpa;

            // Load tables
            loadProgramTable();
            loadFacultyTable();
        }

        function loadProgramTable() {
            const tbody = document.getElementById('program-table-body');
            tbody.innerHTML = '';

            departmentData.programs.forEach(program => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';

                const performanceColor = getPerformanceColor(program.performance);
                const statusBadge = getStatusBadge(program.avgGpa);

                row.innerHTML = `
                    <td class="py-4 px-6 font-medium text-gray-900">${program.name}</td>
                    <td class="py-4 px-4 text-center">
                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${program.students}
                        </span>
                    </td>
                    <td class="py-4 px-4 text-center">
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${program.avgGpa.toFixed(2)}
                        </span>
                    </td>
                    <td class="py-4 px-4 text-center">
                        <span class="bg-${performanceColor}-100 text-${performanceColor}-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${program.performance}
                        </span>
                    </td>
                    <td class="py-4 px-4 text-center">${statusBadge}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function loadFacultyTable() {
            const tbody = document.getElementById('faculty-table-body');
            tbody.innerHTML = '';

            departmentData.faculty.forEach(faculty => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';

                const workloadColor = getWorkloadColor(faculty.workload);

                row.innerHTML = `
                    <td class="py-4 px-6 font-medium text-gray-900">${faculty.name}</td>
                    <td class="py-4 px-4 text-center">
                        <span class="bg-emerald-100 text-emerald-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${faculty.courses}
                        </span>
                    </td>
                    <td class="py-4 px-4 text-center">
                        <span class="bg-${workloadColor}-100 text-${workloadColor}-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${faculty.workload}
                        </span>
                    </td>
                    <td class="py-4 px-4">${faculty.assignedCourses.join(', ')}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function getPerformanceColor(performance) {
            switch(performance) {
                case 'Outstanding': return 'purple';
                case 'Excellent': return 'green';
                case 'Good': return 'blue';
                case 'Satisfactory': return 'yellow';
                default: return 'gray';
            }
        }

        function getStatusBadge(gpa) {
            if (gpa >= 3.5) {
                return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Excellent</span>';
            } else if (gpa >= 3.0) {
                return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">Good</span>';
            } else {
                return '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Needs Improvement</span>';
            }
        }

        function getWorkloadColor(workload) {
            switch(workload) {
                case 'High': return 'red';
                case 'Medium': return 'yellow';
                case 'Low': return 'green';
                default: return 'gray';
            }
        }

        function initializeCharts() {
            // Program Performance Chart
            const programCtx = document.getElementById('programChart').getContext('2d');
            new Chart(programCtx, {
                type: 'doughnut',
                data: {
                    labels: departmentData.programs.map(p => p.name),
                    datasets: [{
                        data: departmentData.programs.map(p => p.students),
                        backgroundColor: [
                            '#3B82F6', '#10B981', '#8B5CF6', '#F59E0B',
                            '#EF4444', '#06B6D4', '#84CC16', '#F97316'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 12,
                                padding: 10,
                                fontSize: 11
                            }
                        }
                    }
                }
            });

            // Faculty Workload Chart
            const workloadCtx = document.getElementById('workloadChart').getContext('2d');
            new Chart(workloadCtx, {
                type: 'bar',
                data: {
                    labels: departmentData.faculty.map(f => f.name.split(' ').slice(-1)[0]),
                    datasets: [{
                        label: 'Courses Assigned',
                        data: departmentData.faculty.map(f => f.courses),
                        backgroundColor: '#10B981',
                        borderColor: '#059669',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 6,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updatePrintInfo() {
            document.getElementById('print-date').textContent = `Generated on: ${new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            })}`;
        }

        // Export Functions
        function toggleExportDropdown() {
            const dropdown = document.getElementById('export-dropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('export-dropdown');
            const button = event.target.closest('button');

            if (!button || !button.onclick || button.onclick.toString().indexOf('toggleExportDropdown') === -1) {
                dropdown.classList.remove('show');
            }
        });

        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');

            // Add header
            pdf.setFontSize(20);
            pdf.text('Department Analytics Report', 20, 30);
            pdf.setFontSize(14);
            pdf.text(departmentData.name, 20, 40);
            pdf.setFontSize(10);
            pdf.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 50);

            // Add statistics
            pdf.setFontSize(12);
            pdf.text('Department Overview:', 20, 70);
            pdf.setFontSize(10);
            pdf.text(`Total Programs: ${departmentData.programs.length}`, 20, 80);
            pdf.text(`Total Faculty: ${departmentData.faculty.length}`, 20, 90);
            pdf.text(`Total Students: ${departmentData.programs.reduce((sum, p) => sum + p.students, 0)}`, 20, 100);

            // Add program table
            let yPos = 120;
            pdf.setFontSize(12);
            pdf.text('Program Performance:', 20, yPos);
            yPos += 10;

            pdf.setFontSize(9);
            departmentData.programs.forEach(program => {
                if (yPos > 270) {
                    pdf.addPage();
                    yPos = 20;
                }
                pdf.text(`${program.name}: ${program.students} students, GPA: ${program.avgGpa}`, 20, yPos);
                yPos += 8;
            });

            pdf.save(`${departmentData.name.replace(/\s+/g, '_')}_Report.pdf`);
            document.getElementById('export-dropdown').classList.remove('show');
        }

        function exportToExcel() {
            // Create CSV content
            let csvContent = "Department Analytics Report\n";
            csvContent += `Department: ${departmentData.name}\n`;
            csvContent += `Generated: ${new Date().toLocaleDateString()}\n\n`;

            csvContent += "Program Performance\n";
            csvContent += "Program Name,Students,Average GPA,Performance\n";
            departmentData.programs.forEach(program => {
                csvContent += `"${program.name}",${program.students},${program.avgGpa},"${program.performance}"\n`;
            });

            csvContent += "\nFaculty Workload\n";
            csvContent += "Faculty Name,Courses,Workload,Assigned Courses\n";
            departmentData.faculty.forEach(faculty => {
                csvContent += `"${faculty.name}",${faculty.courses},"${faculty.workload}","${faculty.assignedCourses.join('; ')}"\n`;
            });

            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${departmentData.name.replace(/\s+/g, '_')}_Report.csv`;
            link.click();

            document.getElementById('export-dropdown').classList.remove('show');
        }

        function printReport() {
            // Show print-only elements
            document.querySelectorAll('.print-only').forEach(el => {
                el.style.display = 'block';
            });

            // Hide print-hidden elements
            document.querySelectorAll('.print-hidden').forEach(el => {
                el.style.display = 'none';
            });

            // Print
            window.print();

            // Restore visibility
            setTimeout(() => {
                document.querySelectorAll('.print-only').forEach(el => {
                    el.style.display = 'none';
                });
                document.querySelectorAll('.print-hidden').forEach(el => {
                    el.style.display = 'block';
                });
            }, 1000);

            document.getElementById('export-dropdown').classList.remove('show');
        }

        async function loadAdminProfile() {
            try {
                const response = await fetch('/admin/api/user-profile/');
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('admin-initials').textContent = data.initials || 'A';
                    document.getElementById('admin-name').textContent = data.name || 'Administrator';
                    document.getElementById('admin-role').textContent = data.role || 'System Administrator';
                }
            } catch (error) {
                console.error('Error loading admin profile:', error);
            }
        }
    </script>

    <style>
        @media print {
            .print-only {
                display: block !important;
            }
            .print-hidden {
                display: none !important;
            }
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .chart-container {
                height: 200px !important;
            }
        }
    </style>
</body>
</html>